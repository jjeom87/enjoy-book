# 구글 엔지니어에게 듣는 네트워킹과 웹 성능 최적화 기법

## 1부 네트워킹 기초
### 1장 레이턴시와 대역폭 이해의 첫걸음
#### 속도는 하나의 특징이다
* 레이턴시 : 패킷을 전송하는 곳에서부터 전달받는 곳까지 이동하는 데 걸리는 시간
* 대역폭 : 논리적인 혹은 물리적인 통신 경로의 최대 처리량
#### 레이턴시의 구성요소
* 전파지연 (propagation delay) : 메시지가 송신측(Sender)에서 수신측(Receiver)으로 이동하는데 필요한 시간. 총 이동 거리 대비 신호가 이동하는 속도로 측정된다.
* 전송지연 (transmission delay) : 링크롤 패킷을 모든 비트를 내보내는 데 필요한 시간. 패킷의 길이 대비 링크의 데이터 전송 속도로 측정된다.
* 프로세싱 지연 (processing delay) : 패킷 해더를 처리하고 비트 수준의 에러를 체크하고 패킷의 목적지를 알아내는 데 필요한 시간.
* 큐잉 지연 (queuing delay) : 패킷이 처리될 때까지 큐(queue)에서 대기하는 시간
#### 빛의 속도와 전파 지연
* 광섬유의 보편적인 굴절률은 1.4 ~ 1.6
* 사용자들을 잘 붙잡아 두는 동시에 최고의 사용자 경험을 제공하기 위해서 애플리케이션은 수백 밀리초 이내에 응답할 수 있어야 함
#### 최종 마일 레이턴시
* 최종 마일 레이턴시는 인터넷 제공업체, 사용되는 기술, 네트워크의 토폴로지, 시간대에 따라 변경됨
#### 코어 네트워크의 대역폭
* 광섬유는 파장 분할 다중화를 통해 각 섬유마다 다른 파장의 빛을 이동시킬 수 있으므로 대역폭에 있어서는 확실한 이점을 가짐
* 광섬유 링크의 총 대역폭은 다중 송신되는 채널의 수에 채널별 데이터 전송률을 곱한 만큼의 값
#### 네트워크 가장자리에서의 대역폭
* 접속자 수가 많거나 하드웨어 오류 혹은 네트워크를 향한 디도스(DDOS) 공격 같은 여러가지 원인으로 인해 네트워크가 정체될 수 있음
#### 높은 대역폭과 낮은 레이턴시 제공
* 대역폭과 빛의 속도라는 한계점을 분명하게 인식하여 프로토콜과 네트워킹 코드를 설계하고 최적화해야만 애플리케이션 성능을 향상 시킬 수 있음
### 2장 TCP의 구성요소
* IP(Internet Protocol)는 호스트에서 호스트로의 라우팅과 주소할당 기능을 제공
* TCP(Transmission Control Protocol) 신뢰성을 보장해주는 네트워크 기능을 제공
* TCP는 신뢰할 수 없는 채널 위에 신뢰성을 구축한 추상 계층
* 네트워크 통신 구현에 필요한 유실 데이터 재전송, 전송 순서 확인, 혼잡 제어 및 회피 데이터 무결성 확인 같은 복잡한 기능을 투명하게 처리하여 애플리케이션 구현을 한결 쉽게 만듬
* TCP 스트림의 특징 중 하나가, 전송된 모든 바이트는 수신된 모든 바이트와 한 치의 오차 없이 동일
* 클라이언트에서 전송한 바이트 순서대로 도착
* TCP는 신속한 데이터 전송보다는 정확한 데이터의 전송에 더 특화
* HTTP 표준은 전송 프로토콜로서 오직 TCP만을 명시하고 있지 않음
#### 3-Way 핸드셰이크
* SYN : 클라이언트가 무작위로 시퀀스 번호 X를 고르고 SYN 패킷을 보낸다. 그 밖의 다른 TCP 플래그나 옵션 값들을 포함할 수 있다.
* SYN ACK : 서버가 시퀀스 번호 X를 1만큼 증가시키고, 무작위 시퀀스 번호 y를 고른다. 서버 또한 플래그와 옵션 값들을 추가한 후 응답을 보낸다.
* ACK : 클라이언트가 X와 Y를 모두 1만큼 증가시킨 후 마지막 ACK 패킷을 보냄으로써 핸드셰이크 과정을 종료한다.
* 3-Way 핸드셰이크가 끝나면 애플리케이션 데이터가 클라이언트와 서버 사이에 오고 갈 수 있음
* 3-Way 핸드셰이크로 인해 발생하는 지연이 크기 떄문에, 새로운 TCP 커넥션을 맺는 것보다 기존에 연결되어 있는 TCP 커넥션을 재사용하는 것이 TCP에서 작동하는 애플리케이션을 최적화하는 데에 아주 중요한 역할을 함
#### 혼잡 제어 및 회피
##### 흐름제어
* 흐름 제어는 송신자가 수신자에게 처리하지 못할 만큼의 많은 데이터를 전송하는 것을 미리 방지하는 매커니즘
* 리시브 윈도를 통지하여 수신 데이터를 저장할 버퍼 공간의 크기를 서로에게 알려줌
* 일단 커넥션이 이루어지면 양쪽에서 자신들의 시스템 기본 설정값을 이용하여 rwnd 값을 초기화함
##### 느린 시작
* 혼잡 윈도 크기 : 클라이언트로부터 응답 확인 신호를 받기 전에 송신자 측에서 지정하는 최대 송신 데이터량
* 서버와 클라이언트는 어떻게 혼잡 윈도 크기의 최적값을 알아내는 것일까?
* 커넥션의 초반에는 천천히 시작해서 ACK 패킷을 받으면서 점점 윈도 사이즈를 늘려 나가는 것